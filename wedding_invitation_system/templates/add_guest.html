{% extends "base.html" %}

{% block title %}הוספת אורח{% endblock %}

{% block content %}
<div class="wedding-header">
    <h1><i class="fas fa-user-plus"></i> הוספת אורח חדש</h1>
    <p class="lead">הוסף אורח חדש לרשימת המוזמנים</p>
</div>

<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-plus-circle"></i> פרטי האורח</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="name" class="form-label">שם מלא *</label>
                        <input type="text" class="form-control" id="name" name="name" required
                               placeholder="לדוגמה: משה כהן">
                        <div class="form-text">השם שיופיע בהזמנה</div>
                    </div>

                    <div class="mb-3">
                        <label for="phone" class="form-label">מספר טלפון (לWhatsApp) *</label>
                        <input type="tel" class="form-control" id="phone" name="phone" required
                               placeholder="לדוגמה: +972501234567 או 0501234567">
                        <div class="form-text">מספר הטלפון לשליחת הזמנות WhatsApp</div>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">כתובת מייל</label>
                        <input type="email" class="form-control" id="email" name="email"
                               placeholder="לדוגמה: moshe@example.com">
                        <div class="form-text">אופציונלי - לשליחת עדכונים</div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="group_affiliation" class="form-label">שיוך לקבוצה</label>
                            <input type="text" class="form-control" id="group_affiliation" name="group_affiliation"
                                   placeholder="לדוגמה: משפחה, חברי עבודה">
                            <div class="form-text">לסיווג האורחים</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="side" class="form-label">מהצד של...</label>
                            <select class="form-select" id="side" name="side">
                                <option value="">בחר צד</option>
                                <option value="חתן">חתן</option>
                                <option value="כלה">כלה</option>
                                <option value="משותף">משותף</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="attendance_status" class="form-label">סטטוס הגעה</label>
                            <select class="form-select" id="attendance_status" name="attendance_status">
                                <option value="ממתין">ממתין לתשובה</option>
                                <option value="יגיע">יגיע</option>
                                <option value="מתלבט">מתלבט</option>
                                <option value="לא יגיע">לא יגיע</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="estimated_gift_amount" class="form-label">סכום מתנה משוער (₪)</label>
                            <input type="number" class="form-control" id="estimated_gift_amount" name="estimated_gift_amount"
                                   min="0" step="50" placeholder="0">
                            <div class="form-text">לתכנון תקציב</div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="notes" class="form-label">הערות</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3"
                                  placeholder="הערות נוספות על האורח..."></textarea>
                    </div>

                    <div class="mb-3">
                        <label for="invited_count" class="form-label">כמה אנשים מוזמנים?</label>
                        <select class="form-select" id="invited_count" name="invited_count">
                            <option value="1">1 אדם</option>
                            <option value="2" selected>2 אנשים (זוג)</option>
                            <option value="3">3 אנשים</option>
                            <option value="4">4 אנשים</option>
                            <option value="5">5 אנשים</option>
                            <option value="6">6 אנשים</option>
                            <option value="7">7 אנשים</option>
                            <option value="8">8 אנשים</option>
                        </select>
                        <div class="form-text">כולל האורח עצמו ובני המשפחה שלו</div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save"></i> הוסף אורח
                        </button>
                        <a href="{{ url_for('admin') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-right"></i> חזור לרשימה
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- כרטיס עזרה -->
        <div class="card mt-4">
            <div class="card-header">
                <h6><i class="fas fa-info-circle"></i> טיפים</h6>
            </div>
            <div class="card-body">
                <ul class="small mb-0">
                    <li><strong>מספר טלפון:</strong> ודא שהמספר תקין ויש לו WhatsApp</li>
                    <li><strong>שם:</strong> השתמש בשם שהאורח יזהה (כמו שכתוב בהזמנה המודפסת)</li>
                    <li><strong>מספר מוזמנים:</strong> כולל את האורח עצמו</li>
                    <li><strong>לכל אורח יתווצר קישור ייחודי</strong> לאישור הגעה</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- תצוגה מקדימה של ההזמנה -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-eye"></i> תצוגה מקדימה של ההזמנה</h6>
            </div>
            <div class="card-body">
                <div class="preview-invitation p-3 border rounded bg-light">
                    <div class="text-center">
                        <h6>🎉 הזמנה לחתונה! 🎉</h6>
                        <hr>
                        <p class="mb-1">שלום <strong id="preview-name">שם האורח</strong>!</p>
                        <p class="small text-muted">אנחנו שמחים להזמין אותך לחתונה של<br>החתן והכלה</p>
                        <p class="small">📅 תאריך: תאריך החתונה</p>
                        <p class="small">👨‍👩‍👧‍👦 מוזמנים: <strong id="preview-count">2</strong> אנשים</p>
                        <div class="bg-primary text-white p-2 rounded small">
                            בבקשה אשר/י הגעה בקישור הייחודי
                        </div>
                        <p class="small text-muted mt-2">אנחנו מחכים לכם! 💕</p>
                    </div>
                </div>
                
                <div class="mt-3">
                    <h6>מה יקרה אחרי ההוספה?</h6>
                    <ol class="small">
                        <li>האורח יתווסף למערכת</li>
                        <li>יתווצר קישור ייחודי לאישור הגעה</li>
                        <li>תוכל לשלוח הזמנה דרך WhatsApp</li>
                        <li>האורח יוכל לאשר כמה אנשים מגיעים</li>
                        <li>תוכל לעקוב אחרי התגובות</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// עדכון תצוגה מקדימה בזמן אמת
document.getElementById('name').addEventListener('input', function() {
    const name = this.value || 'שם האורח';
    document.getElementById('preview-name').textContent = name;
});

document.getElementById('invited_count').addEventListener('change', function() {
    document.getElementById('preview-count').textContent = this.value;
});

// תיקוף מספר טלפון
document.getElementById('phone').addEventListener('input', function() {
    const phone = this.value;
    const phoneRegex = /^(\+972|0)[1-9]\d{8}$/;
    
    if (phone && !phoneRegex.test(phone.replace(/[-\s]/g, ''))) {
        this.setCustomValidity('מספר הטלפון לא תקין. השתמש בפורמט: +972501234567 או 0501234567');
    } else {
        this.setCustomValidity('');
    }
});
</script>
{% endblock %}